title = "ثبت ایده"
url = "/portal/new_idea"
layout = "panel"
description = "ثبت ایده"
is_hidden = 0

[session]
security = "user"
redirect = "signin"
==
<?php
use RainLab\User\Facades\Auth;
use RahmanMahdi\Kharazm\Models\Idea;
use RahmanMahdi\Kharazm\Models\IdeaMember;
use RahmanMahdi\Kharazm\Models\Score;
use Hekmatinasser\Verta\Verta;

function onStart()
{
    $user = Auth::getUser();
    $this['user_scores'] = Score::where('user_id', $user->id)->whereIn('status', [1, 2])->sum('score');
}

function onSave()
{
    $user = Auth::getUser();

    $idea = new Idea();
    $idea->user_id       = $user->id;
    $idea->group         = post('group');
    $idea->category      = post('category');
    $idea->status        = post('status');
    $idea->group_name    = post('group_name');
    $idea->title         = post('title');
    $idea->description   = post('description');
    $idea->similar_idea  = post('similar_idea');
    $idea->level         = post('level');
    $idea->idea_property = post('idea_property');
    $idea->your_request  = post('your_request');
    $idea->save();

    $full_names                  = post('full_name');
    $birth_dates                 = post('birth_date');
    $mobiles                     = post('mobile');
    $emails                      = post('email');
    $degree_and_field_of_studies = post('degree_and_field_of_study');
    $specialties                 = post('specialty');

    for($i = 0; $i<count($full_names); $i++)
    {
        if(trim($full_names[$i]) != '')
        {
            $birth_date = '';
            $numt = ['۰'=>'0','۱'=>'1','۲'=>'2','۳'=>'3','۴'=>'4','۵'=>'5','۶'=>'6','۷'=>'7','۸'=>'8','۹'=>'9'];
            $post_birth_date  = strtr($birth_dates[$i], $numt);
            if($birth_dates[$i] != '' && substr($post_birth_date,0,2) < 18)
            {
                $date = explode(' ', $post_birth_date);
                $date = explode('/', $date[0]);
                $date = Verta::getGregorian($date[0], $date[1], $date[2]);
                $birth_date = $date[0] . '/' . $date[1] . '/' . $date[2];
            }

            $idea_member = new IdeaMember();

            $idea_member->idea_id                   = $idea->id;
            $idea_member->full_name                 = $full_names[$i];
            $idea_member->birth_date                = '0000-00-00';
            if($birth_dates[0] != '')
                $idea_member->birth_date            = $birth_date;
            $idea_member->mobile                    = $mobiles[$i];
            $idea_member->email                     = $emails[$i];
            $idea_member->degree_and_field_of_study = $degree_and_field_of_studies[$i];
            $idea_member->specialty                 = $specialties[$i];

            $idea_member->save();
        }
    }

    $New_Idea_Score = Score::where('user_id', $user->id)->where('label', 'new_idea')->whereIn('status', [1, 2])->first();

    $Score = new Score();
    $Score->user_id = $user->id;
    $Score->score = 10;
    $Score->description = 'ثبت ایده';
    $Score->label = 'new_idea';
    $Score->status = 0;
    if(is_null($New_Idea_Score))
        $Score->status = 1;
    $Score->save();

    Flash::success('ایده شما با موفقیت ثبت شد');
    return Redirect::to('/portal/new_idea');
}
?>
==
<!-- BEGIN: Content-->
<div class="app-content content">
    <div class="content-overlay"></div>
    <div class="content-wrapper">
        <div class="content-header row">
            <div class="content-header-left col-12 mb-2 mt-1">
                <div class="row breadcrumbs-top">
                    <div class="col-12">
                        <h5 class="content-header-title float-left pr-1">ثبت ایده</h5>
                        <div class="breadcrumb-wrapper">
                            <ol class="breadcrumb p-0 mb-0">
                                <li class="breadcrumb-item"><a href="/portal"><i class="bx bx-home-alt"></i></a></li>
                                <li class="breadcrumb-item active">ثبت ایده</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="content-body"><!-- Form wizard with icon tabs section start -->
            <section id="icon-tabs">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">ثبت ایده</h4>
                            </div>
                            <div class="card-content mt-2">
                                <div class="card-body">
                                    <form method="POST" id="new_wizard_form" data-request="onSave" data-request-validate class="wizard-validation">
                                        <!-- Step 1 -->
                                        <h6>
                                            <i class="step-icon"></i>
                                            <span class="fonticon-wrap">
                                              <i class="livicon-evo" data-options="name:morph-doc.svg; size: 50px; style:lines; strokeColor:#adb5bd;"></i>
                                            </span>
                                        </h6>
                                        <!-- Step 1 end-->
                                        <!-- body content step 1 -->
                                        <fieldset>
                                            <div class="row">
                                                <div class="col-12">
                                                    <h6 class="py-50">سرپرست تیم</h6>
                                                </div>
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label>باتوجه به گروه های تخصصی شتابدهنده اندیشه خوارزم ، ایده شما در کدام گروه قرار می گیرد؟</label>
                                                        <select class="form-control" id="group" name="group">
                                                            <option value="1">تجارت الکترونیک</option>
                                                            <option value="2">سلامت</option>
                                                            <option value="3">گردشگری</option>
                                                            <option value="4">سایر حوزه های مرتبط با IT</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label>ایده شما درکدام دسته بندی رایج ایده ها واقع شده است؟</label>
                                                        <select class="form-control" id="category" name="category">
                                                            <option value="1">کاملا جدید</option>
                                                            <option value="2">بازتولید با نگاه نوآورانه</option>
                                                            <option value="3">مهندس معکوس</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label>وضعیت</label>
                                                        <select class="form-control" id="status" name="status">
                                                            <option value="1">فعال</option>
                                                            <option value="2">مسدود شده</option>
                                                            <option value="3">بستن</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                        <!-- body content step 1 end-->
                                        <!-- Step 2 -->
                                        <h6>
                                            <i class="step-icon"></i>
                                            <span class="fonticon-wrap">
                                              <i class="livicon-evo" data-options="name:users.svg; size: 50px; style:lines; strokeColor:#adb5bd;"></i>
                                            </span>
                                        </h6>
                                        <!-- Step 2 end-->
                                        <!-- body content of step 2 -->
                                        <fieldset>
                                            <div class="row">
                                                <div class="col-12">
                                                    <h6 class="py-50">مشخصات گروه کاری</h6>
                                                </div>
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label>نام گروه</label>
                                                        <input type="text" id="group_name" name="group_name" class="form-control required" placeholder="نام گروه را وارد کنید" value="">
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="table-responsive">
                                                        <div class="card">
                                                            <div class="card-header">
                                                                <h4 class="card-title">اعضای گروه</h4>
                                                            </div>
                                                            <div class="card-content">
                                                                <div class="card-body">
                                                                    <div data-repeater-list="contact">
                                                                        <div class="row">
                                                                            <!--<div class="col-12 mb-2">
                                                                                <button class="btn btn-icon rounded-circle btn-primary" type="button" data-repeater-create="">
                                                                                    <i class="bx bx-plus"></i>
                                                                                </button>
                                                                                <span class="ml-1 font-weight-bold text-primary">افزودن جدید</span>
                                                                            </div>-->
                                                                            <div class="col-md-2 col-2 mb-50">
                                                                                <label class="text-nowrap">نام و نام خانوادگی</label>
                                                                            </div>
                                                                            <div class="col-md-2 col-2 mb-50">
                                                                                <label class="text-nowrap">تاریخ تولد</label>
                                                                            </div>
                                                                            <div class="col-md-1 col-1 mb-50">
                                                                                <label class="text-nowrap">تلفن همراه</label>
                                                                            </div>
                                                                            <div class="col-md-2 col-2 mb-50">
                                                                                <label class="text-nowrap">پست الکترونیکی</label>
                                                                            </div>
                                                                            <div class="col-md-2 col-2 mb-50">
                                                                                <label class="text-nowrap">مدرک تحصیلی و رشته تحصیلی</label>
                                                                            </div>
                                                                            <div class="col-md-2 col-2 mb-50">
                                                                                <label class="text-nowrap">تخصص در تیم</label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="row justify-content-between" data-repeater-item="">
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="full_name[]" class="form-control required" placeholder="نام و نام خانوادگی">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="birth_date[]" class="form-control birthdate-picker required" placeholder="تاریخ تولد">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="mobile[]" class="form-control text-left required" placeholder="تلفن همراه" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="email[]" class="form-control text-left required" placeholder="پست الکترونیکی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="degree_and_field_of_study[]" class="form-control text-left required" placeholder="مدرک تحصیلی و رشته تحصیلی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="specialty[]" class="form-control text-left" placeholder="تخصص در تیم" dir="ltr">
                                                                            </div>
                                                                            <!--<div class="col-md-1 col-1 form-group">
                                                                                <button class="btn btn-icon btn-danger rounded-circle" type="button" data-repeater-delete="">
                                                                                    <i class="bx bx-x"></i>
                                                                                </button>
                                                                            </div>-->
                                                                        </div>
                                                                        <div class="row justify-content-between" data-repeater-item="">
                                                                            <div class="col-md-2 col-2 form-group d-flex align-items-center">
                                                                                <input type="text" name="full_name[]" class="form-control" placeholder="نام و نام خانوادگی">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="birth_date[]" class="form-control birthdate-picker" placeholder="تاریخ تولد">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="mobile[]" class="form-control text-left" placeholder="تلفن همراه" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="email[]" class="form-control text-left" placeholder="پست الکترونیکی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="degree_and_field_of_study[]" class="form-control text-left" placeholder="مدرک تحصیلی و رشته تحصیلی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="specialty[]" class="form-control text-left" placeholder="تخصص در تیم" dir="ltr">
                                                                            </div>
                                                                            <!--<div class="col-md-1 col-1 form-group">
                                                                                <button class="btn btn-icon btn-danger rounded-circle" type="button" data-repeater-delete="">
                                                                                    <i class="bx bx-x"></i>
                                                                                </button>
                                                                            </div>-->
                                                                        </div>
                                                                        <div class="row justify-content-between" data-repeater-item="">
                                                                            <div class="col-md-2 col-2 form-group d-flex align-items-center">
                                                                                <input type="text" name="full_name[]" class="form-control" placeholder="نام و نام خانوادگی">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="birth_date[]" class="form-control birthdate-picker" placeholder="تاریخ تولد">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="mobile[]" class="form-control text-left" placeholder="تلفن همراه" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="email[]" class="form-control text-left" placeholder="پست الکترونیکی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="degree_and_field_of_study[]" class="form-control text-left" placeholder="مدرک تحصیلی و رشته تحصیلی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="specialty[]" class="form-control text-left" placeholder="تخصص در تیم" dir="ltr">
                                                                            </div>
                                                                            <!--<div class="col-md-1 col-1 form-group">
                                                                                <button class="btn btn-icon btn-danger rounded-circle" type="button" data-repeater-delete="">
                                                                                    <i class="bx bx-x"></i>
                                                                                </button>
                                                                            </div>-->
                                                                        </div>
                                                                        <div class="row justify-content-between" data-repeater-item="">
                                                                            <div class="col-md-2 col-2 form-group d-flex align-items-center">
                                                                                <input type="text" name="full_name[]" class="form-control" placeholder="نام و نام خانوادگی">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="birth_date[]" class="form-control birthdate-picker" placeholder="تاریخ تولد">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="mobile[]" class="form-control text-left" placeholder="تلفن همراه" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="email[]" class="form-control text-left" placeholder="پست الکترونیکی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="degree_and_field_of_study[]" class="form-control text-left" placeholder="مدرک تحصیلی و رشته تحصیلی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="specialty[]" class="form-control text-left" placeholder="تخصص در تیم" dir="ltr">
                                                                            </div>
                                                                            <!--<div class="col-md-1 col-1 form-group">
                                                                                <button class="btn btn-icon btn-danger rounded-circle" type="button" data-repeater-delete="">
                                                                                    <i class="bx bx-x"></i>
                                                                                </button>
                                                                            </div>-->
                                                                        </div>
                                                                        <div class="row justify-content-between" data-repeater-item="">
                                                                            <div class="col-md-2 col-2 form-group d-flex align-items-center">
                                                                                <input type="text" name="full_name[]" class="form-control" placeholder="نام و نام خانوادگی">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="birth_date[]" class="form-control birthdate-picker" placeholder="تاریخ تولد">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="mobile[]" class="form-control text-left" placeholder="تلفن همراه" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="email[]" class="form-control text-left" placeholder="پست الکترونیکی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="degree_and_field_of_study[]" class="form-control text-left" placeholder="مدرک تحصیلی و رشته تحصیلی" dir="ltr">
                                                                            </div>
                                                                            <div class="col-md-2 col-2 form-group">
                                                                                <input type="text" name="specialty[]" class="form-control text-left" placeholder="تخصص در تیم" dir="ltr">
                                                                            </div>
                                                                            <!--<div class="col-md-1 col-1 form-group">
                                                                                <button class="btn btn-icon btn-danger rounded-circle" type="button" data-repeater-delete="">
                                                                                    <i class="bx bx-x"></i>
                                                                                </button>
                                                                            </div>-->
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                        <!-- body content of step 2 end-->
                                        <!-- Step 3 -->
                                        <h6>
                                            <i class="step-icon"></i>
                                            <span class="fonticon-wrap">
                                              <i class="livicon-evo" data-options="name:home.svg; size: 50px; style:lines; strokeColor:#adb5bd;"></i>
                                            </span>
                                        </h6>
                                        <!-- Step 3 end-->
                                        <!-- body content of Step 3 -->
                                        <fieldset>
                                            <div class="row">
                                                <div class="col-12">
                                                    <h6 class="py-50">مشخصات ایده</h6>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-group">
                                                        <div class="controls">
                                                            <label>عنوان ایده</label>
                                                            <input type="text" id="title" name="title" class="form-control text-left required" placeholder="عنوان ایده" value="" dir="ltr">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-group">
                                                        <label>شرح ایده ( مختصر ، دقیق ، صریح):</label>
                                                        <textarea rows="4" id="description" name="description" class="form-control required"></textarea>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-group">
                                                        <label>آیا ایده شما بر گرفته از موارد مشابهی است ؟ (در صورت وجود نام ببرید)</label>
                                                        <input type="text" id="similar_idea" name="similar_idea" class="form-control text-left required" placeholder="" value="" dir="ltr">
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-group">
                                                        <div class="controls">
                                                            <label>ایده شما در چه مرحله است؟</label>
                                                            <select class="form-control" id="level" name="level">
                                                                <option value="1">ظهور</option>
                                                                <option value="2">پردازش اولیه</option>
                                                                <option value="3">رشد یافته (بلوغ)</option>
                                                            </select>

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-group">
                                                        <label>ویژگی مشخص ایده شما چیست ؟ (چه چیزی شما را از رقبا متمایز می کند؟)</label>
                                                        <textarea rows="4" id="idea_property" name="idea_property" class="form-control required"></textarea>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-group">
                                                        <label>درخواست شما از شتابدهنده چیست؟</label>
                                                        <textarea rows="4" id="your_request" name="your_request" class="form-control"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                        <!-- body content of Step 3 end-->
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Form wizard with number tabs section end -->
        </div>
    </div>
</div>
<!-- END: Content-->

<!-- Vertically Centered modal Modal -->
<div class="modal fade" id="ModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle">ثبت ایده</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="بستن">
                    <i class="bx bx-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>
                    با ثبت ایده در پرتال شتابدهنده به فروشگاه ایده وارد شوید
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-secondary" data-dismiss="modal">
                  <i class="bx bx-x d-block d-sm-none"></i>
                  <span class="d-none d-sm-block">بعدا یاداوری کن</span>
                </button>
                <button type="button" class="btn btn-primary ml-1" data-dismiss="modal">
                    <i class="bx bx-check d-block d-sm-none"></i>
                    <span class="d-none d-sm-block">ثبت ایده</span>
                </button>
            </div>
        </div>
    </div>
</div>

{% if user_scores < 30 %}
{% put scripts %}
<script type="text/javascript">
    $(window).on('load', function() {
        $('#ModalCenter').modal('show');
    });
</script>
{% endput %}
{% endif %}